<!DOCTYPE html>
<html>
  <head>
    <title>Realtime Media Stream</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!-- 
         === NOTA BENE ===
         For the three scripts below, if your spec resides on dev.w3 you can check them
         out in the same tree and use relative links so that they'll work offline,
      -->
    <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
      // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
      specStatus:           "ED",
      
      // the specification's short name, as in http://www.w3.org/TR/short-name/
      shortName:            "rt-media",

      // if your specification has a subtitle that goes below the main
      // formal title, define it here
      subtitle   :  "Realtime Media Streaming API",

      // if you wish the publication date to be other than today, set this
      // publishDate:  "2009-08-06",

      // if the specification's copyright date is a range of years, specify
      // the start date here:
      copyrightStart: "2012",

      // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
      // and its maturity status
      // previousPublishDate:  "1977-03-15",
      // previousMaturity:  "WD",

      // if there a publicly available Editor's Draft, this is the link
      edDraftURI:           "https://github.com/martinthomson/webrtc/realtime-media-stream.html",

      // if this is a LCWD, uncomment and set the end of its review period
      // lcEnd: "2009-08-05",

      // if you want to have extra CSS, append them to this list
      // it is recommended that the respec.css stylesheet be kept
      extraCSS:             ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css"],

      // editors, add as many as you like
      // only "name" is required
      editors:  [
      { name: "Martin Thomson", url: "mailto:martin.thomson@gmail.com",
        company: "Microsoft", companyURL: "http://microsoft.com/" }
      ],

      // authors, add as many as you like. 
      // This is optional, uncomment if you have authors as well as editors.
      // only "name" is required. Same format as editors.

      authors:  [
      { name: "Bernard Aboba", url: "mailto:bernard_aboba@hotmail.com",
        company: "Microsoft", companyURL: "http://microsoft.com/" }
      ],
      
      // name of the WG
      wg:           "WebRTC Working Group",
      
      // URI of the public WG page
      wgURI:        "http://www.w3.org/standards/techs/webrtc",
      
      // name (without the @w3c.org) of the public mailing to which comments are due
      wgPublicList: "public-webrtc",
      
      // URI of the patent status for this WG, for Rec-track documents
      // !!!! IMPORTANT !!!!
      // This is important for Rec-track documents, do not copy a patent URI from a random
      // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
      // Team Contact.
      wgPatentURI:  ""
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      An API is described for sourcing and terminating streams of realtime media in a browser.  The API provides a means of describing how media streams are serialized into a stream of RTP packets or deserialized from a stream of packets.
    </section>
    
    <section>
      <h2>Introduction</h2>
      <p>
        Realtime communications between browsers depends on the packetization of media.  This API provides a way to control how media streams are turned into packets and how those packets are turned into media streams.
      </p>
      <p>
        Interoperable realtime media between browsers uses RTP [[!I-D.rtcweb-rtp-usage]].  RTP depends on the existence of a signaling channel to establish a common understanding of the meaning of packets.  This includes identification of different streams, codecs, and codec parameters.
      </p>
      <p>
        An RTP session consists of a series of RTP streams.  Each stream has a source and one or more sinks.  This API provides objects that directly map to RTP streams.  The source and sink of each realtime media stream is a <code>MediaStreamTrack</code> [[!mediacapture-streams]].  This allows applications to build more complex arrangements of streams, composing them into aggregate <code>MediaStream</code> collections.
      </p>
      <p>
        Exchanging media in real time between browsers requires the use of a real time media transport, such as is described in [[!rt-transport]].
      </p>
    </section>

    <section>
      <h2>Overview</h2>
      <p>
        The exchange of realtime media between two browsers follows the process:
        <ol>
          <li>
            At the media source, input devices are opened for capture.
          </li>
          <li>
            Media from the input devices is encoded into packets that are transmitted across the network.
            </li>
          <li>
            At the media destination, the packets are decoded and formed into a media stream.
          </li>
          <li>
            The media stream is sent to output devices.
          </li>
        </ol>
      </p>
      <p>
        Local capture and playback of media (steps 1. and 4.) can be achieved by the media capture API [[!mediacapture-streams]].  The realtime media streaming API provides access to functions that allow for the transmission of media stream across a network between these two points.
      </p>
      <img src="overview.png" alt="Image showing overview of realtime media" title="Overview of Realtime Media" />
      <p>
        The basic primitive of this API, the <code><a>RealtimeMediaStream</a></code> is a single, unidirectional stream of media.  This basic unit can be used to assemble more complex communications scenarios.  For example, an application that wishes to enable two-way audio and video communications between peers can create four such streams: an audio stream in each direction, plus a video stream in each direction.
      </p>
      <p>
        In order to transmit a track from a local media stream&mdash;audio or video&mdash;an application takes the track and a <code>RealtimeTransport</code> [[!rt-transport]] and creates a <code><a>RealtimeMediaStream</a></code>.  A <code><a>RealtimeMediaDescription</a></code> is used to describe how the track is encoded.
      </p>
      <pre class="example">
navigator.getUserMedia({ audio: true }, function(media) {
    var track = media.audioTracks[0];
    var description = new RealtimeMediaDescription(track);
    var localRtStream = description.createStream(track, realtimeTransport);
    signalingChannel.send(JSON.stringify(description));
});
      </pre>
      <p>
        In order to receive the same stream, the <code><a>RealtimeMediaDescription</a></code> is signaled between the two peers.  This description can be used to create a <code><a>RealtimeMediaStream</a></code> that decodes encoded tracks.
      </p>
      <pre class="example">
function receiveDescriptionFromSignaling(remoteDescription) {
    var description = new RealtimeMediaDescription(remoteDescription);
    var remoteRtStream = description.createStream(realtimeTransport);
    var remoteMedia = new MediaStream(remoteRtStream.track);
    outputTag.src = URL.createObjectURL(remoteMedia);
});
      </pre>
    </section>

    <section>
      <h2>The RealtimeMediaStream Object</h2>
      <p>
        A <code>RealtimeMediaStream</code> represents a uni-directional flow of media to or from the browser.
      </p>
      <p>
        Instances of <code>RealtimeMediaStream</code> are created by <code><a>RealtimeMediaDescription</a></code>.
      </p>
      <dl title="[NoInterfaceObject] interface RealtimeMediaStream : EventTarget" class="idl">
        <dt>readonly attribute MediaStreamTrack track</dt>
        <dd>
          The media track that is either being consumed or produced by this realtime media stream.
        </dd>
        <dt>readonly attribute RealtimeTransport transport</dt>
        <dd>
          The transport that is being used to transmit and receive RTP packets.
        </dd>
        <dt>readonly attribute RealtimeTransport rtcpTransport</dt>
        <dd>
          The transport that is being used to transmit and receive RTCP packets.
        </dd>
        <dt>readonly attribute RealtimeMediaDescription description</dt>
        <dd>
          The description that is being used for this stream.
        </dd>
        <dt>readonly attribute RealtimeMediaDescription description</dt>
        <dd>
          The description that is being used for this stream.
        </dd>
        <dt>void updateDescription(RealtimeMediaDescription description)</dt>
        <dd>
          Change the description that is being used for the stream atomically.
        </dd>
        <dt>void updateTransport(RealtimeTransport transport, optional RealtimeTransport rtcpTransport)</dt>
        <dd>
          Change the underlying transport that is being used for the stream.  Optionally, set a different transport for the RTCP feedback for the stream.  If the <code>rtcpTransport</code> parameter is omitted or the same as the <code>transport</code>, then RTCP multiplexing with RTP [[!RFC5761]] is used.
        </dd>
      </dl>
      <section>
        <h3>The <code>LocalRealtimeMediaStream</code> Object</h3>
        <p>
          The <code>LocalRealtimeMediaStream</code> represents a locally-sourced stream of realtime media.
        </p>
        <dl title="[NoInterfaceObject] interface LocalRealtimeMediaStream : RealtimeMediaStream" class="idl">
          <dt>void play()</dt>
          <dd>
            Causes the encoding of the stream and the corresponding creation of packets to be resumed.
          </dd>
          <dt>void pause()</dt>
          <dd>
            Causes the encoding of the stream and the corresponding creation of packets to be temporarily suspended.
          </dd>
          <dt>attribute EventHandler? onplay</dt>
          <dd>
            Called when playing commences, as requested by <code><a href="#widl-RealtimeMediaStream-play-void">play</a>()</code>.
          </dd>
          <dt>attribute EventHandler? onpause</dt>
          <dd>
            Called when playing of the stream pauses, as requested by <code><a href="#widl-RealtimeMediaStream-play-void">play</a>()</code>.
          </dd>
        </dl>
      </section>

      <section>
        <h3>The <code>RemoteRealtimeMediaStream</code> Object</h3>
        <p>
          A <code>RemoteRealtimeMediaStream</code> represents a stream of realtime media that originates on the network.
        </p>
        <dl title="[NoInterfaceObject] interface RemoteRealtimeMediaStream : RealtimeMediaStream" class="idl">
          <dt>attribute UnknownPacketTypeEventHandler? onunknownpackettype</dt>
          <dd>
            Called when an <a href="#unknownpackettype">unknown packet type</a> arrives on the stream.
          </dd>
        </dl>

        <section id="unknownpackettype">
          <h4>Dealing with Mismatched Media Descriptions</h4>
          <p>
            Some errors in media descriptions cannot be immediately detected by the browser.  Descriptions that contain unsupported or conflicting features can be readily detected.  Other errors are not obvious until incompatible media arrives.
          </p>
          <p>
            One such error arises for an incoming stream when an RTP packet type is not assigned to a codec. In this case, the first instance of an RTP packet arriving with an unknown packet type triggers an <code>UnknownPacketTypeEvent</code> to be fired.  After the first instance of this event, packets marked with the unknown packet type are ignored.
          </p>
          <p>
            Updating the <code><a>RealtimeMediaDescription</a></code> on a stream resets the event status of any existing unknown packet types.  When another packet containing an unknown packet type arrives, the event is fired once more.
          </p>
        </section>
      </section>
    </section>

    <section>
      <h2>The <code>RealtimeMediaDescription</code> Object</h2>
      <p>
        A <code>RealtimeMediaDescription</code> is the basic means of specifying what a packetized stream of media looks like.  A <code>RealtimeMediaDescription</code> is used to specify what an outgoing stream is to look like and to describe what an incoming stream looks like.
      </p>
      <p>
        Specific sub-classes are used for describing outbound and inbound streams, though the basic parameters are common.
      </p>
      <dl title="[NoInterfaceObject] interface RealtimeMediaDescription" class="idl">
        <dt>readonly attribute RtpStreamDescription[] streams</dt>
        <dd>
          A description of the RTP streams that comprise the realtime stream.  Most codecs only support a single RTP stream.  Only layered codecs such as H.264 SVC [[!RFC6190]] are encoded into multiple streams.
        </dd>
        <dt>readonly attribute DOMString cname</dt>
        <dd>
          The RTCP Canonical Name (CNAME) used to identify this browser as a source of media in RTCP.  As described in [[I-D.rtcweb-rtp-usage]], the browser generates a short-term CNAME that cannot be linked to its identity over time.
        </dd>
        <dt>RtcpFeature[] rtcpFeatures</dt>
        <dd>
          The set of RTCP features that are used by the described stream(s).
        </dd>
        <dt>CodecDescription[] codecs</dt>
        <dd>
          A description of the set of codecs that are used by the described stream(s).
        </dd>
        <dt>RealtimeMediaDesctiption update (RealtimeMediaDescriptionDictionary constraints)</dt>
        <dd>
          Update the description to include only those settings that are specified in the provided dictionary.  This can be used as a basis for negotiating a common set of capabilities between peers.  This throws an <code>Error</code> if the resulting description cannot possibly be used to describe any realtime stream because the constraints are incompatible with the current state of the description.
        </dd>
        <dt>RealtimeMediaDescriptionDictionary update (RealtimeMediaDescriptionConstraints constraints)</dt>
        <dd>
          Update the description to conform to the provided constraints.  This throws an <code>Error</code> if the mandatory constraints cannot be met.
        </dd>
      </dl>
      <section>
        <h3>The <code>RealtimeMediaDescriptionDictionary</code> Object</h3>
        <p>
          Since a media description is likely to be exchanged over a signaling channel, this object represents the value of a <code><a>RealtimeMediaDescription</a></code> without the corresponding methods.
        </p>
        <dl title="dictionary RealtimeMediaDescriptionDictionary" class="idl">
          <dt>RtpStreamDescription[] streams</dt>
          <dd>
            A description of the RTP streams that comprise the realtime stream.
          </dd>
          <dt>DOMString cname</dt>
          <dd>
            The RTCP Canonical Name (CNAME) used to identify this browser as a source of media in RTCP.
          </dd>
          <dt>RtcpFeature[] rtcpFeatures</dt>
          <dd>
            The set of RTCP features that are used by the described stream(s).
          </dd>
          <dt>CodecDescription[] codecs</dt>
          <dd>
            A description of the set of codecs that are used by the described stream(s).
          </dd>
        </dl>
      </section>
      <section>
        <h3>The <code>LocalRealtimeMediaDescription</code> Object</h3>
        <p>
          A <code><a>LocalRealtimeMediaDescription</a></code> is used to describe the packetization of locally originated streams of media.  Outbound streams are automatically constrained by what features the browser supports for transmission of media.
        </p>
        <!-- want to support all variations on the constructor, which means three different constructors -->
        <dl title="[Constructor (optional MediaStreamTrack track, optional RealtimeMediaDescriptionDictionary description, optional RealtimeMediaDescriptionConstraints constraints)] interface LocalRealtimeMediaDescription : RealtimeMediaDescription" class="idl">
          <dt>LocalRealtimeMediaStream createStream (MediaStreamTrack track, RealtimeTransport transport, optional RealtimeTransport rtcpTransport)</dt>
          <dd>
          </dd>
        </dl>
      </section>
      <section>
        <h3>The <code>RemoteRealtimeMediaDescription</code> Object</h3>
        <p>
</p>
        <dl title="[Constructor (optional RealtimeMediaDescriptionDictionary description, optional RealtimeMediaDescriptionConstraints constraints)] interface RemoteRealtimeMediaDescription : RealtimeMediaDescription" class="idl">
          <dt>RemoteRealtimeMediaStream createStream (RealtimeTransport transport, optional RealtimeTransport rtcpTransport)</dt>
          <dd>
          </dd>
        </dl>
      </section>
    </section>
    
    <section class='appendix'>
      <h2>Acknowledgements</h2>
      <p>
        Your name here.
      </p>
    </section>
  </body>
</html>
